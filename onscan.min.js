var scannerDetector={attachTo:function(e,t){if(null!=e.scannerDetectionData)throw new Error("scannerDetector is already initialized");t=this._mergeOptions({onScan:function(){},onScanError:function(){},onKeyProcessed:function(){},onKeyDetect:function(){},onPaste:function(){},keyCodeMapper:function(){},onScanButtonLongPressed:function(){},scanButtonKeyCode:!1,scanButtonLongPressThreshold:500,timeBeforeScanTest:100,avgTimeByChar:30,minLength:6,endCharCodes:[9,13],startCharCodes:[],ignoreIfFocusOn:!1,stopPropagation:!1,preventDefault:!1,acceptPasteInput:!1,singleScanQty:1},t),e.scannerDetectionData={options:t,vars:{firstCharTime:0,lastCharTime:0,stringWriting:"",callIsScanner:!1,testTimer:!1,longPressTimeStart:0,longPressed:!1}},t.acceptPasteInput&&e.addEventListener("paste",this._handlePaste),!1!==t.scanButtonKeyCode&&e.addEventListener("keyup",this._handleKeyUp),e.addEventListener("keydown",this._handleKeyDown)},detachFrom:function(e){e.scannerDetectionData.options.acceptPasteInput&&e.removeEventListener("paste",this._handlePaste),!1!==e.scannerDetectionData.options.scanButtonKeyCode&&e.removeEventListener("keyup",this._handleKeyUp),e.removeEventListener("keydown",this._handleKeyDown),e.scannerDetectionData=void 0},getOptionsOf:function(e){return e.scannerDetectionData.options},setOptionsOf:function(e,t){switch(e.scannerDetectionData.options.acceptPasteInput){case!0:0==t.acceptPasteInput&&e.removeEventListener("paste",this._handlePaste);break;case!1:1==t.acceptPasteInput&&e.addEventListener("paste",this._handlePaste)}switch(e.scannerDetectionData.options.scanButtonKeyCode){case!1:!1!==t.scanButtonKeyCode&&e.addEventListener("keyup",this._handleKeyUp);break;default:!1===t.scanButtonKeyCode&&e.removeEventListener("keyup",this._handleKeyUp)}e.scannerDetectionData.options=this._mergeOptions(e.scannerDetectionData.options,t),this._reinitialize(e)},simulate:function(e,t){var n=e.scannerDetectionData.vars;return n.firstCharTime=0,n.lastCharTime=0,n.stringWriting=t,this._validateScanCode(e),this},_reinitialize:function(e){var t=e.scannerDetectionData.vars;t.firstCharTime=0,t.stringWriting=""},_isFocusOnIgnoredElement:function(e){if(oIgnoredObject=e.scannerDetectionData.options.ignoreIfFocusOn,!oIgnoredObject)return!1;var t=document.activeElement;if(Array.isArray(oIgnoredObject)){for(var n=0;n<oIgnoredObject.length;n++)if(Object.is(t,oIgnoredObject[n])||Object.is(t,document.getElementById(oIgnoredObject[n])))return!0}else if(Object.is(t,oIgnoredObject)||Object.is(t,document.getElementById(oIgnoredObject)))return!0;return!1},_validateScanCode:function(e){var t=e.scannerDetectionData,n=t.options,a=t.options.singleScanQty,r=t.vars.stringWriting,s=t.vars.firstCharTime,i=t.vars.lastCharTime;switch(!0){case r.length<n.minLength:var o={message:"Receieved code is shorter then minimal length"};break;case i-s>r.length*n.avgTimeByChar:o={message:"Receieved code was not entered in time"};break;default:n.onScan.call(e,r,a);var c=new CustomEvent("scan",{detail:{scanCode:r,qty:a}});return e.dispatchEvent(c),scannerDetector._reinitialize(e),!0}o.scanCode=r,o.scanDuration=i-s,o.avgTimeByChar=n.avgTimeByChar,o.minLength=n.minLength,n.onScanError.call(e,o);c=new CustomEvent("scanError",o);return e.dispatchEvent(c),scannerDetector._reinitialize(e),!1},_mergeOptions:function(e,t){var n,a={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n]);return a},_getNormalizedKeyNum:function(e){var t;return window.event?t=e.keyCode:e.which&&(t=e.which),t},_handleKeyDown:function(e){e.which=scannerDetector._getNormalizedKeyNum(e);var t=e.which,n=this.scannerDetectionData.options,a=this.scannerDetectionData.vars;n.onKeyDetect.call(this,e);var r=new CustomEvent("scannerDetectionKeyDetect",{evt:e});if(this.dispatchEvent(r),!scannerDetector._isFocusOnIgnoredElement(this))if(!1===n.scanButtonKeyCode||t!=n.scanButtonKeyCode){switch(n.stopPropagation&&e.stopImmediatePropagation(),n.preventDefault&&e.preventDefault(),!0){case a.firstCharTime&&-1!==n.endCharCodes.indexOf(t):e.preventDefault(),e.stopImmediatePropagation(),this.scannerDetectionData.vars.callIsScanner=!0;break;case!a.firstCharTime&&-1!==n.startCharCodes.indexOf(t):e.preventDefault(),e.stopImmediatePropagation(),a.callIsScanner=!1;break;default:var s=n.keyCodeMapper.call(this,e);if(null===s)return;void 0===s&&(s=String.fromCharCode(t)),a.stringWriting+=s,a.callIsScanner=!1}a.firstCharTime||(a.firstCharTime=Date.now()),a.lastCharTime=Date.now(),a.testTimer&&clearTimeout(a.testTimer),a.callIsScanner?(scannerDetector._validateScanCode(this),a.testTimer=!1):a.testTimer=setTimeout(scannerDetector._validateScanCode,n.timeBeforeScanTest,this),n.onKeyProcessed.call(this,e);r=new CustomEvent("scannerDetectionKeyReceive",{evt:e});this.dispatchEvent(r)}else a.longPressed||(a.longPressTimer=setTimeout(n.onScanButtonLongPressed,n.scanButtonLongPressThreshold,this),a.longPressed=!0)},_handlePaste:function(e){if(!scannerDetector._isFocusOnIgnoredElement(this)){e.preventDefault();var t=(event.clipboardData||window.clipboardData).getData("text");this.scannerDetectionData.options.onPaste.call(this,t);var n=this.scannerDetectionData.vars;n.firstCharTime=0,n.lastCharTime=0,n.stringWriting=t,scannerDetector._validateScanCode(this)}},_handleKeyUp:function(e){scannerDetector._isFocusOnIgnoredElement(this)||scannerDetector._getNormalizedKeyNum(e)==this.scannerDetectionData.options.scanButtonKeyCode&&(clearTimeout(this.scannerDetectionData.vars.longPressTimer),this.scannerDetectionData.vars.longPressed=!1)}};